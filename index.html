<!doctype html>
<html lang="pt-BR">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Projects</title>
    <style>
        body {
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
            margin: 24px;
            line-height: 1.4;
        }

        header {
            margin-bottom: 16px;
        }

        .muted {
            color: #666;
            font-size: 0.95rem;
        }

        .card {
            border: 1px solid #ddd;
            border-radius: 12px;
            padding: 16px;
            margin: 14px 0;
        }

        h2 {
            margin: 0 0 10px;
            font-size: 1.2rem;
        }

        ul {
            margin: 0;
            padding-left: 18px;
        }

        li {
            margin: 6px 0;
        }

        a {
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        .error {
            color: #b00020;
            white-space: pre-wrap;
        }

        .loading {
            opacity: 0.8;
        }

        code {
            background: #f6f6f6;
            padding: 2px 6px;
            border-radius: 6px;
        }
    </style>
</head>

<body>
    <header>
        <h1>Arquivos por Projeto</h1>
        <div class="muted">
            Lista dinâmica baseada na pasta <code>projects/</code> do repositório.
        </div>
    </header>

    <div id="status" class="loading">Carregando…</div>
    <div id="content"></div>

    <script>
        /**
         * CONFIGURE AQUI:
         * - owner: seu username do GitHub
         * - repo: nome do repo (ex: "SEUUSER.github.io" ou "static-files")
         * - branch: normalmente "main"
         * - projectsDir: pasta onde ficam os projetos
         * - siteBase: base do seu site no Pages
         *
         * Exemplos de siteBase:
         * - Se repo é "SEUUSER.github.io": siteBase = "https://SEUUSER.github.io"
         * - Se repo é "docs": siteBase = "https://SEUUSER.github.io/docs"
         */
        const CONFIG = {
            owner: "gabrielyamashita",
            repo: "Arquivos",
            branch: "main",
            siteBase: "https://gabrielyamashita.github.io/Arquivos",
            projectsDir: "Projects",
        };

        const statusEl = document.getElementById("status");
        const contentEl = document.getElementById("content");

        function apiUrl(path) {
            // GitHub Contents API
            // path exemplo: "projects", "projects/demo"
            return `https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/contents/${path}?ref=${encodeURIComponent(CONFIG.branch)}`;
        }

        function isPdf(item) {
            return item.type === "file" && item.name.toLowerCase().endsWith(".pdf");
        }

        function isDir(item) {
            return item.type === "dir";
        }

        function fileLink(projectName, fileName) {
            // Link público no Pages
            return `${CONFIG.siteBase}/${CONFIG.projectsDir}/${encodeURIComponent(projectName)}/${encodeURIComponent(fileName)}`;
        }

        async function fetchJson(url) {
            const res = await fetch(url, {
                headers: { "Accept": "application/vnd.github+json" }
            });
            if (!res.ok) {
                const text = await res.text();
                throw new Error(`HTTP ${res.status} ao chamar ${url}\n${text}`);
            }
            return res.json();
        }

        function renderProjectCard(projectName, files) {
            const card = document.createElement("div");
            card.className = "card";

            const title = document.createElement("h2");
            title.textContent = projectName;
            card.appendChild(title);

            if (!files.length) {
                const p = document.createElement("div");
                p.className = "muted";
                p.textContent = "Nenhum PDF encontrado.";
                card.appendChild(p);
                return card;
            }

            const ul = document.createElement("ul");
            files.forEach(f => {
                const li = document.createElement("li");
                const a = document.createElement("a");
                a.href = fileLink(projectName, f.name);
                a.textContent = f.name;
                a.target = "_blank";
                a.rel = "noopener noreferrer";
                li.appendChild(a);
                ul.appendChild(li);
            });
            card.appendChild(ul);

            return card;
        }

        async function main() {
            try {
                statusEl.textContent = "Buscando projetos…";

                // 1) Lista diretório projects/
                const rootItems = await fetchJson(apiUrl(CONFIG.projectsDir));
                const projectDirs = rootItems.filter(isDir);

                if (!projectDirs.length) {
                    statusEl.classList.remove("loading");
                    statusEl.textContent = `Não encontrei pastas em "${CONFIG.projectsDir}/".`;
                    return;
                }

                statusEl.textContent = `Encontrados ${projectDirs.length} projetos. Carregando PDFs…`;

                // 2) Para cada projeto, busca os arquivos e filtra PDFs
                const results = [];
                for (const dir of projectDirs) {
                    const projectName = dir.name;
                    const items = await fetchJson(apiUrl(`${CONFIG.projectsDir}/${projectName}`));
                    // const pdfs = items.filter(isPdf);
                    const pdfs = items
                    results.push({ projectName, pdfs });
                }

                // 3) Render
                contentEl.innerHTML = "";
                results
                    .sort((a, b) => a.projectName.localeCompare(b.projectName))
                    .forEach(r => contentEl.appendChild(renderProjectCard(r.projectName, r.pdfs)));

                statusEl.classList.remove("loading");
                statusEl.textContent = "OK.";
            } catch (err) {
                statusEl.classList.remove("loading");
                statusEl.className = "error";
                statusEl.textContent = String(err);
            }
        }

        main();
    </script>
</body>

</html>